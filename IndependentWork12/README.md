# Звіт: Самостійна робота No12 — PLINQ: дослідження продуктивності та безпеки

## Мета
Дослідити переваги та недоліки PLINQ у порівнянні зі звичайним LINQ, виміряти продуктивність на різних обсягах даних та проаналізувати потенційні проблеми безпеки при паралельній обробці.

## Методологія
1. Колекції: 1 000 000; 5 000 000; 10 000 000 елементів.
2. Дані: List<double>, заповнений випадковими числами.
3. Операції:
   - `heavySqrt` — багаторазове обчислення Math.Sqrt (імітація CPU-bound).
   - `primeLike` — перевірка числа на простоту.
4. Кожен тест: 3 прогони для LINQ і PLINQ.
5. Результати зберігаються у файлі `results.csv`.

## Результати

### Таблиця середнього часу виконання (ms)

| Test       | Size       | Avg LINQ (ms) | Avg PLINQ (ms) | PLINQ швидший? |
|------------|-----------:|--------------:|---------------:|:--------------:|
| heavySqrt  | 1 000 000  | 1065          | 138            | Так            |
| primeLike  | 1 000 000  | 5064          | 667            | Так            |
| heavySqrt  | 5 000 000  | 4483          | 427            | Так            |
| primeLike  | 5 000 000  | 25253         | 660            | Так            |
| heavySqrt  | 10 000 000 | 8986          | 806            | Так            |
| primeLike  | 10 000 000 | 50333,5       | 6603,66        | Так            |

## Аналіз
- PLINQ значно швидший за LINQ для великих, обчислювально-важких задач.
- При невеликих наборах або легких операціях вигоди може не бути через накладні витрати на паралельність.
- Різниця між PLINQ і LINQ зростає зі збільшенням розміру колекції.

## Сценарій з побічними ефектами
- При модифікації зовнішньої змінної без синхронізації (`unsafeCounter`) виникає race condition і результат виявляється некоректним.
- Виправлення:
  - `lock` — гарантує коректність, але знижує паралельність.
  - `Interlocked.Increment` — ефективний і безпечний спосіб для простих інкрементів.
  - `ConcurrentBag` — безпечний для збору даних у паралельних обчисленнях.

## Висновки
- PLINQ варто використовувати для великих CPU-bound задач.
- Важливо уникати побічних ефектів у паралельних лямбдах або застосовувати механізми синхронізації.
- Перед застосуванням PLINQ рекомендується профілювати код та аналізувати, чи дійсно паралелізація дасть вигоду.